import{a as e}from"./keccak.c0da6441.js";import{e as r,a as t,c as n}from"./index.645b5434.js";import{b as i}from"./index.08ee57ca.js";const a="Impossible case. Please create issue.",o="The tweak was out of range or the resulted private key is invalid",c="The tweak was out of range or equal to zero",s="Unknow error on context randomization",u="Private Key is invalid",l="Public Key could not be parsed",p="Public Key serialization error",y="The sum of the public keys is not valid",d="Signature could not be parsed",h="The nonce generation function failed, or the private key was invalid",f="Public key could not be recover",w="Scalar was invalid (zero or overflow)";function b(e,r){if(!e)throw new Error(r)}function v(e,r,t){if(b(r instanceof Uint8Array,`Expected ${e} to be an Uint8Array`),void 0!==t)if(Array.isArray(t)){const n=`Expected ${e} to be an Uint8Array with length [${t.join(", ")}]`;b(t.includes(r.length),n)}else{const n=`Expected ${e} to be an Uint8Array with length ${t}`;b(r.length===t,n)}}function g(e){b("Boolean"===K(e),"Expected compressed to be a Boolean")}function m(e=(e=>new Uint8Array(e)),r){return"function"==typeof e&&(e=e(r)),v("output",e,r),e}function K(e){return Object.prototype.toString.call(e).slice(8,-1)}const E=new(0,r.ec)("secp256k1"),k=E.curve,A=k.n.constructor;function x(e){const r=e[0];switch(r){case 2:case 3:return 33!==e.length?null:function(e,r){let t=new A(r);if(t.cmp(k.p)>=0)return null;t=t.toRed(k.red);let n=t.redSqr().redIMul(t).redIAdd(k.b).redSqrt();return 3===e!==n.isOdd()&&(n=n.redNeg()),E.keyPair({pub:{x:t,y:n}})}(r,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:function(e,r,t){let n=new A(r),i=new A(t);if(n.cmp(k.p)>=0||i.cmp(k.p)>=0)return null;if(n=n.toRed(k.red),i=i.toRed(k.red),(6===e||7===e)&&i.isOdd()!==(7===e))return null;const a=n.redSqr().redIMul(n);return i.redSqr().redISub(a.redIAdd(k.b)).isZero()?E.keyPair({pub:{x:n,y:i}}):null}(r,e.subarray(1,33),e.subarray(33,65));default:return null}}function U(e,r){const t=r.encode(null,33===e.length);for(let n=0;n<e.length;++n)e[n]=t[n]}var P,I=(P={contextRandomize:()=>0,privateKeyVerify(e){const r=new A(e);return r.cmp(k.n)<0&&!r.isZero()?0:1},privateKeyNegate(e){const r=new A(e),t=k.n.sub(r).umod(k.n).toArrayLike(Uint8Array,"be",32);return e.set(t),0},privateKeyTweakAdd(e,r){const t=new A(r);if(t.cmp(k.n)>=0)return 1;if(t.iadd(new A(e)),t.cmp(k.n)>=0&&t.isub(k.n),t.isZero())return 1;const n=t.toArrayLike(Uint8Array,"be",32);return e.set(n),0},privateKeyTweakMul(e,r){let t=new A(r);if(t.cmp(k.n)>=0||t.isZero())return 1;t.imul(new A(e)),t.cmp(k.n)>=0&&(t=t.umod(k.n));const n=t.toArrayLike(Uint8Array,"be",32);return e.set(n),0},publicKeyVerify:e=>null===x(e)?1:0,publicKeyCreate(e,r){const t=new A(r);if(t.cmp(k.n)>=0||t.isZero())return 1;return U(e,E.keyFromPrivate(r).getPublic()),0},publicKeyConvert(e,r){const t=x(r);if(null===t)return 1;return U(e,t.getPublic()),0},publicKeyNegate(e,r){const t=x(r);if(null===t)return 1;const n=t.getPublic();return n.y=n.y.redNeg(),U(e,n),0},publicKeyCombine(e,r){const t=new Array(r.length);for(let i=0;i<r.length;++i)if(t[i]=x(r[i]),null===t[i])return 1;let n=t[0].getPublic();for(let i=1;i<t.length;++i)n=n.add(t[i].pub);return n.isInfinity()?2:(U(e,n),0)},publicKeyTweakAdd(e,r,t){const n=x(r);if(null===n)return 1;if((t=new A(t)).cmp(k.n)>=0)return 2;const i=n.getPublic().add(k.g.mul(t));return i.isInfinity()?2:(U(e,i),0)},publicKeyTweakMul(e,r,t){const n=x(r);if(null===n)return 1;if((t=new A(t)).cmp(k.n)>=0||t.isZero())return 2;return U(e,n.getPublic().mul(t)),0},signatureNormalize(e){const r=new A(e.subarray(0,32)),t=new A(e.subarray(32,64));return r.cmp(k.n)>=0||t.cmp(k.n)>=0?1:(1===t.cmp(E.nh)&&e.set(k.n.sub(t).toArrayLike(Uint8Array,"be",32),32),0)},signatureExport(e,r){const t=r.subarray(0,32),n=r.subarray(32,64);if(new A(t).cmp(k.n)>=0)return 1;if(new A(n).cmp(k.n)>=0)return 1;const{output:i}=e;let a=i.subarray(4,37);a[0]=0,a.set(t,1);let o=33,c=0;for(;o>1&&0===a[c]&&!(128&a[c+1]);--o,++c);if(a=a.subarray(c),128&a[0])return 1;if(o>1&&0===a[0]&&!(128&a[1]))return 1;let s=i.subarray(39,72);s[0]=0,s.set(n,1);let u=33,l=0;for(;u>1&&0===s[l]&&!(128&s[l+1]);--u,++l);return s=s.subarray(l),128&s[0]||u>1&&0===s[0]&&!(128&s[1])?1:(e.outputlen=6+o+u,i[0]=48,i[1]=e.outputlen-2,i[2]=2,i[3]=a.length,i.set(a,4),i[4+o]=2,i[5+o]=s.length,i.set(s,6+o),0)},signatureImport(e,r){if(r.length<8)return 1;if(r.length>72)return 1;if(48!==r[0])return 1;if(r[1]!==r.length-2)return 1;if(2!==r[2])return 1;const t=r[3];if(0===t)return 1;if(5+t>=r.length)return 1;if(2!==r[4+t])return 1;const n=r[5+t];if(0===n)return 1;if(6+t+n!==r.length)return 1;if(128&r[4])return 1;if(t>1&&0===r[4]&&!(128&r[5]))return 1;if(128&r[t+6])return 1;if(n>1&&0===r[t+6]&&!(128&r[t+7]))return 1;let i=r.subarray(4,4+t);if(33===i.length&&0===i[0]&&(i=i.subarray(1)),i.length>32)return 1;let a=r.subarray(6+t);if(33===a.length&&0===a[0]&&(a=a.slice(1)),a.length>32)throw new Error("S length is too long");let o=new A(i);o.cmp(k.n)>=0&&(o=new A(0));let c=new A(r.subarray(6+t));return c.cmp(k.n)>=0&&(c=new A(0)),e.set(o.toArrayLike(Uint8Array,"be",32),0),e.set(c.toArrayLike(Uint8Array,"be",32),32),0},ecdsaSign(e,r,t,n,i){if(i){const e=i;i=i=>{const a=e(r,t,null,n,i);if(!(a instanceof Uint8Array&&32===a.length))throw new Error("This is the way");return new A(a)}}const a=new A(t);if(a.cmp(k.n)>=0||a.isZero())return 1;let o;try{o=E.sign(r,t,{canonical:!0,k:i,pers:n})}catch(c){return 1}return e.signature.set(o.r.toArrayLike(Uint8Array,"be",32),0),e.signature.set(o.s.toArrayLike(Uint8Array,"be",32),32),e.recid=o.recoveryParam,0},ecdsaVerify(e,r,t){const n={r:e.subarray(0,32),s:e.subarray(32,64)},i=new A(n.r),a=new A(n.s);if(i.cmp(k.n)>=0||a.cmp(k.n)>=0)return 1;if(1===a.cmp(E.nh)||i.isZero()||a.isZero())return 3;const o=x(t);if(null===o)return 2;const c=o.getPublic();return E.verify(r,n,c)?0:3},ecdsaRecover(e,r,t,n){const i={r:r.slice(0,32),s:r.slice(32,64)},a=new A(i.r),o=new A(i.s);if(a.cmp(k.n)>=0||o.cmp(k.n)>=0)return 1;if(a.isZero()||o.isZero())return 2;let c;try{c=E.recoverPubKey(n,i,t)}catch(s){return 2}return U(e,c),0},ecdh(e,r,t,n,i,a,o){const c=x(r);if(null===c)return 1;const s=new A(t);if(s.cmp(k.n)>=0||s.isZero())return 2;const u=c.getPublic().mul(s);if(void 0===i){const r=u.encode(null,!0),t=E.hash().update(r).digest();for(let n=0;n<32;++n)e[n]=t[n]}else{a||(a=new Uint8Array(32));const r=u.getX().toArray("be",32);for(let e=0;e<32;++e)a[e]=r[e];o||(o=new Uint8Array(32));const t=u.getY().toArray("be",32);for(let e=0;e<32;++e)o[e]=t[e];const c=i(a,o,n);if(!(c instanceof Uint8Array&&c.length===e.length))return 2;e.set(c)}return 0}},{contextRandomize(e){switch(b(null===e||e instanceof Uint8Array,"Expected seed to be an Uint8Array or null"),null!==e&&v("seed",e,32),P.contextRandomize(e)){case 1:throw new Error(s)}},privateKeyVerify:e=>(v("private key",e,32),0===P.privateKeyVerify(e)),privateKeyNegate(e){switch(v("private key",e,32),P.privateKeyNegate(e)){case 0:return e;case 1:throw new Error(a)}},privateKeyTweakAdd(e,r){switch(v("private key",e,32),v("tweak",r,32),P.privateKeyTweakAdd(e,r)){case 0:return e;case 1:throw new Error(o)}},privateKeyTweakMul(e,r){switch(v("private key",e,32),v("tweak",r,32),P.privateKeyTweakMul(e,r)){case 0:return e;case 1:throw new Error(c)}},publicKeyVerify:e=>(v("public key",e,[33,65]),0===P.publicKeyVerify(e)),publicKeyCreate(e,r=!0,t){switch(v("private key",e,32),g(r),t=m(t,r?33:65),P.publicKeyCreate(t,e)){case 0:return t;case 1:throw new Error(u);case 2:throw new Error(p)}},publicKeyConvert(e,r=!0,t){switch(v("public key",e,[33,65]),g(r),t=m(t,r?33:65),P.publicKeyConvert(t,e)){case 0:return t;case 1:throw new Error(l);case 2:throw new Error(p)}},publicKeyNegate(e,r=!0,t){switch(v("public key",e,[33,65]),g(r),t=m(t,r?33:65),P.publicKeyNegate(t,e)){case 0:return t;case 1:throw new Error(l);case 2:throw new Error(a);case 3:throw new Error(p)}},publicKeyCombine(e,r=!0,t){b(Array.isArray(e),"Expected public keys to be an Array"),b(e.length>0,"Expected public keys array will have more than zero items");for(const n of e)v("public key",n,[33,65]);switch(g(r),t=m(t,r?33:65),P.publicKeyCombine(t,e)){case 0:return t;case 1:throw new Error(l);case 2:throw new Error(y);case 3:throw new Error(p)}},publicKeyTweakAdd(e,r,t=!0,n){switch(v("public key",e,[33,65]),v("tweak",r,32),g(t),n=m(n,t?33:65),P.publicKeyTweakAdd(n,e,r)){case 0:return n;case 1:throw new Error(l);case 2:throw new Error(o)}},publicKeyTweakMul(e,r,t=!0,n){switch(v("public key",e,[33,65]),v("tweak",r,32),g(t),n=m(n,t?33:65),P.publicKeyTweakMul(n,e,r)){case 0:return n;case 1:throw new Error(l);case 2:throw new Error(c)}},signatureNormalize(e){switch(v("signature",e,64),P.signatureNormalize(e)){case 0:return e;case 1:throw new Error(d)}},signatureExport(e,r){v("signature",e,64);const t={output:r=m(r,72),outputlen:72};switch(P.signatureExport(t,e)){case 0:return r.slice(0,t.outputlen);case 1:throw new Error(d);case 2:throw new Error(a)}},signatureImport(e,r){switch(v("signature",e),r=m(r,64),P.signatureImport(r,e)){case 0:return r;case 1:throw new Error(d);case 2:throw new Error(a)}},ecdsaSign(e,r,t={},n){v("message",e,32),v("private key",r,32),b("Object"===K(t),"Expected options to be an Object"),void 0!==t.data&&v("options.data",t.data),void 0!==t.noncefn&&b("Function"===K(t.noncefn),"Expected options.noncefn to be a Function");const i={signature:n=m(n,64),recid:null};switch(P.ecdsaSign(i,e,r,t.data,t.noncefn)){case 0:return i;case 1:throw new Error(h);case 2:throw new Error(a)}},ecdsaVerify(e,r,t){switch(v("signature",e,64),v("message",r,32),v("public key",t,[33,65]),P.ecdsaVerify(e,r,t)){case 0:return!0;case 3:return!1;case 1:throw new Error(d);case 2:throw new Error(l)}},ecdsaRecover(e,r,t,n=!0,i){switch(v("signature",e,64),b("Number"===K(r)&&r>=0&&r<=3,"Expected recovery id to be a Number within interval [0, 3]"),v("message",t,32),g(n),i=m(i,n?33:65),P.ecdsaRecover(i,e,r,t)){case 0:return i;case 1:throw new Error(d);case 2:throw new Error(f);case 3:throw new Error(a)}},ecdh(e,r,t={},n){switch(v("public key",e,[33,65]),v("private key",r,32),b("Object"===K(t),"Expected options to be an Object"),void 0!==t.data&&v("options.data",t.data),void 0!==t.hashfn?(b("Function"===K(t.hashfn),"Expected options.hashfn to be a Function"),void 0!==t.xbuf&&v("options.xbuf",t.xbuf,32),void 0!==t.ybuf&&v("options.ybuf",t.ybuf,32),v("output",n)):n=m(n,32),P.ecdh(n,e,r,t.data,t.hashfn,t.xbuf,t.ybuf)){case 0:return n;case 1:throw new Error(l);case 2:throw new Error(w)}}}),_=e.exports,C=t.exports.Buffer,T=n,O=i,S=I,j=C.from("Bitcoin seed","utf8"),N={private:76066276,public:76067358};function V(e){this.versions=e||N,this.depth=0,this.index=0,this._privateKey=null,this._publicKey=null,this.chainCode=null,this._fingerprint=0,this.parentFingerprint=0}function B(e,r,t){var n=C.allocUnsafe(78);n.writeUInt32BE(r,0),n.writeUInt8(e.depth,4);var i=e.depth?e.parentFingerprint:0;return n.writeUInt32BE(i,5),n.writeUInt32BE(e.index,9),e.chainCode.copy(n,13),t.copy(n,45),n}function M(e){var r=T.createHash("sha256").update(e).digest();return T.createHash("ripemd160").update(r).digest()}Object.defineProperty(V.prototype,"fingerprint",{get:function(){return this._fingerprint}}),Object.defineProperty(V.prototype,"identifier",{get:function(){return this._identifier}}),Object.defineProperty(V.prototype,"pubKeyHash",{get:function(){return this.identifier}}),Object.defineProperty(V.prototype,"privateKey",{get:function(){return this._privateKey},set:function(e){_.equal(e.length,32,"Private key must be 32 bytes."),_(!0===S.privateKeyVerify(e),"Invalid private key"),this._privateKey=e,this._publicKey=C.from(S.publicKeyCreate(e,!0)),this._identifier=M(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0)}}),Object.defineProperty(V.prototype,"publicKey",{get:function(){return this._publicKey},set:function(e){_(33===e.length||65===e.length,"Public key must be 33 or 65 bytes."),_(!0===S.publicKeyVerify(e),"Invalid public key"),this._publicKey=C.from(S.publicKeyConvert(e,!0)),this._identifier=M(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0),this._privateKey=null}}),Object.defineProperty(V.prototype,"privateExtendedKey",{get:function(){return this._privateKey?O.encode(B(this,this.versions.private,C.concat([C.alloc(1,0),this.privateKey]))):null}}),Object.defineProperty(V.prototype,"publicExtendedKey",{get:function(){return O.encode(B(this,this.versions.public,this.publicKey))}}),V.prototype.derive=function(e){if("m"===e||"M"===e||"m'"===e||"M'"===e)return this;var r=e.split("/"),t=this;return r.forEach((function(e,r){if(0!==r){var n=e.length>1&&"'"===e[e.length-1],i=parseInt(e,10);_(i<2147483648,"Invalid index"),n&&(i+=2147483648),t=t.deriveChild(i)}else _(/^[mM]{1}/.test(e),'Path must start with "m" or "M"')})),t},V.prototype.deriveChild=function(e){var r,t=e>=2147483648,n=C.allocUnsafe(4);if(n.writeUInt32BE(e,0),t){_(this.privateKey,"Could not derive hardened child key");var i=this.privateKey,a=C.alloc(1,0);i=C.concat([a,i]),r=C.concat([i,n])}else r=C.concat([this.publicKey,n]);var o=T.createHmac("sha512",this.chainCode).update(r).digest(),c=o.slice(0,32),s=o.slice(32),u=new V(this.versions);if(this.privateKey)try{u.privateKey=C.from(S.privateKeyTweakAdd(C.from(this.privateKey),c))}catch(l){return this.deriveChild(e+1)}else try{u.publicKey=C.from(S.publicKeyTweakAdd(C.from(this.publicKey),c,!0))}catch(l){return this.deriveChild(e+1)}return u.chainCode=s,u.depth=this.depth+1,u.parentFingerprint=this.fingerprint,u.index=e,u},V.prototype.sign=function(e){return C.from(S.ecdsaSign(e,this.privateKey).signature)},V.prototype.verify=function(e,r){return S.ecdsaVerify(Uint8Array.from(r),Uint8Array.from(e),Uint8Array.from(this.publicKey))},V.prototype.wipePrivateData=function(){return this._privateKey&&T.randomBytes(this._privateKey.length).copy(this._privateKey),this._privateKey=null,this},V.prototype.toJSON=function(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}},V.fromMasterSeed=function(e,r){var t=T.createHmac("sha512",j).update(e).digest(),n=t.slice(0,32),i=t.slice(32),a=new V(r);return a.chainCode=i,a.privateKey=n,a},V.fromExtendedKey=function(e,r){var t=new V(r=r||N),n=O.decode(e),i=n.readUInt32BE(0);_(i===r.private||i===r.public,"Version mismatch: does not match private or public"),t.depth=n.readUInt8(4),t.parentFingerprint=n.readUInt32BE(5),t.index=n.readUInt32BE(9),t.chainCode=n.slice(13,45);var a=n.slice(45);return 0===a.readUInt8(0)?(_(i===r.private,"Version mismatch: version does not match private"),t.privateKey=a.slice(1)):(_(i===r.public,"Version mismatch: version does not match public"),t.publicKey=a),t},V.fromJSON=function(e){return V.fromExtendedKey(e.xpriv)},V.HARDENED_OFFSET=2147483648;var Z=V;export{Z as h};

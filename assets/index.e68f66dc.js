function e(e,n){var i="string"==typeof e?Object.assign({},t[e]):e;if("object"!=typeof i)throw new Error("[Portis] illegal 'network' parameter. Read more about it here: https://docs.portis.io/#/configuration?id=network");if(!i.nodeUrl)throw new Error("[Portis] 'nodeUrl' is required. Read more about it here: https://docs.portis.io/#/configuration?id=network");if(n&&!i.gasRelayHubAddress)throw new Error("[Portis] can't find default gas relay hub for "+e);return"string"!=typeof e||n||delete i.gasRelayHubAddress,i}var t={mainnet:{nodeUrl:"https://mainnet.infura.io/v3/faa4639b090f46499f29d894da0551a0",chainId:"1",gasRelayHubAddress:"0xD216153c06E857cD7f72665E0aF1d7D82172F494"},ropsten:{nodeUrl:"https://ropsten.infura.io/v3/faa4639b090f46499f29d894da0551a0",chainId:"3",gasRelayHubAddress:"0xD216153c06E857cD7f72665E0aF1d7D82172F494"},rinkeby:{nodeUrl:"https://rinkeby.infura.io/v3/faa4639b090f46499f29d894da0551a0",chainId:"4",gasRelayHubAddress:"0xD216153c06E857cD7f72665E0aF1d7D82172F494"},goerli:{nodeUrl:"https://goerli.prylabs.net",chainId:"5"},ubiq:{nodeUrl:"https://rpc1.ubiqscan.io",chainId:"8"},thundercoreTestnet:{nodeUrl:"https://testnet-rpc.thundercore.com:8544",chainId:"18"},orchid:{nodeUrl:"https://public-node.rsk.co",chainId:"30"},orchidTestnet:{nodeUrl:"https://public-node.testnet.rsk.co",chainId:"31"},kovan:{nodeUrl:"https://kovan.infura.io/v3/faa4639b090f46499f29d894da0551a0",chainId:"42",gasRelayHubAddress:"0xD216153c06E857cD7f72665E0aF1d7D82172F494"},classic:{nodeUrl:"https://ethereumclassic.network",chainId:"61"},sokol:{nodeUrl:"https://sokol.poa.network",chainId:"77"},core:{nodeUrl:"https://core.poa.network",chainId:"99"},xdai:{nodeUrl:"https://dai.poa.network",chainId:"100",gasRelayHubAddress:"0xD216153c06E857cD7f72665E0aF1d7D82172F494"},thundercore:{nodeUrl:"https://mainnet-rpc.thundercore.com",chainId:"108"},fuse:{nodeUrl:"https://rpc.fusenet.io",chainId:"122"},lightstreams:{nodeUrl:"https://node.mainnet.lightstreams.io",chainId:"163"},matic:{nodeUrl:"https://rpc-mainnet.matic.network",chainId:"137"},maticMumbai:{nodeUrl:"https://rpc-mumbai.matic.today",chainId:"80001"},maticAlpha:{nodeUrl:"https://alpha.ethereum.matic.network",chainId:"4626"},maticTestnet:{nodeUrl:"https://testnet2.matic.network",chainId:"8995"}},n=function(){return!("undefined"==typeof window||!window.document)},i=!1;function r(){return new Promise((function(e,t){n()?i?e():["loaded","interactive","complete"].indexOf(document.readyState)>-1?(i=!0,e()):window.addEventListener("load",(function(){i=!0,e()}),!1):t()}))}function o(){var e="localhost"===location.hostname||"127.0.0.1"===location.hostname,t="https:"===location.protocol;if(!(e||t))throw"[Portis] Access to the WebCrypto API is restricted to secure origins.\nIf this is a development environment please use http://localhost:"+location.port+" instead.\nOtherwise, please use an SSL certificate."}var a={};Object.defineProperty(a,"__esModule",{value:!0});var s=a.default=a.ERR_NOT_IN_IFRAME=a.ERR_CONNECTION_TIMEOUT=a.ERR_CONNECTION_DESTROYED=void 0,c="message";a.ERR_CONNECTION_DESTROYED="ConnectionDestroyed";a.ERR_CONNECTION_TIMEOUT="ConnectionTimeout";a.ERR_NOT_IN_IFRAME="NotInIframe";var u,d={"http:":"80","https:":"443"},l=/^(https?:)?\/\/([^/:]+)(:(\d+))?/,h={ERR_CONNECTION_DESTROYED:"ConnectionDestroyed",ERR_CONNECTION_TIMEOUT:"ConnectionTimeout",ERR_NOT_IN_IFRAME:"NotInIframe",Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},f=(u=0,function(){return++u}),g=function(){if(h.debug){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,["[Penpal]"].concat(n))}},p=function(e){var t=[];return e((function(){t.forEach((function(e){e()}))})),{then:function(e){t.push(e)}}},m=function(e){return{name:e.name,message:e.message,stack:e.stack}},v=function(e){var t=new Error;return Object.keys(e).forEach((function(n){return t[n]=e[n]})),t},w=function(e,t,n,i){var r=t.localName,o=t.local,a=t.remote,s=t.remoteOrigin,u=!1;g("".concat(r,": Connecting call sender"));i.then((function(){u=!0})),n.reduce((function(e,t){return e[t]=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(g("".concat(r,": Sending ").concat(e,"() call")),u){var d=new Error("Unable to send ".concat(e,"() call due ")+"to destroyed connection");throw d.code="ConnectionDestroyed",d}return new h.Promise((function(t,i){var u=f();o.addEventListener(c,(function n(d){if(d.source===a&&d.origin===s&&"reply"===d.data.penpal&&d.data.id===u){g("".concat(r,": Received ").concat(e,"() reply")),o.removeEventListener(c,n);var l=d.data.returnValue;d.data.returnValueIsError&&(l=v(l)),("fulfilled"===d.data.resolution?t:i)(l)}})),a.postMessage({penpal:"call",id:u,methodName:e,args:n},s)}))}}(t),e}),e)},b=function(e,t,n){var i=e.localName,r=e.local,o=e.remote,a=e.remoteOrigin,s=!1;g("".concat(i,": Connecting call receiver"));var u=function(e){if(e.source===o&&e.origin===a&&"call"===e.data.penpal){var n=e.data,r=n.methodName,c=n.args,u=n.id;if(g("".concat(i,": Received ").concat(r,"() call")),r in t){var d=function(e){return function(t){if(g("".concat(i,": Sending ").concat(r,"() reply")),s)g("".concat(i,": Unable to send ").concat(r,"() reply due to destroyed connection"));else{var n={penpal:"reply",id:u,resolution:e,returnValue:t};"rejected"===e&&t instanceof Error&&(n.returnValue=m(t),n.returnValueIsError=!0);try{o.postMessage(n,a)}catch(c){throw"DataCloneError"===c.name&&o.postMessage({penpal:"reply",id:u,resolution:"rejected",returnValue:m(c),returnValueIsError:!0},a),c}}}};new h.Promise((function(e){return e(t[r].apply(t,c))})).then(d("fulfilled"),d("rejected"))}}};r.addEventListener(c,u),n.then((function(){s=!0,r.removeEventListener(c,u)}))};h.connectToChild=function(e){var t,n=e.url,i=e.appendTo,r=e.methods,o=void 0===r?{}:r,a=e.timeout,s=new p((function(e){t=e})),u=window,f=document.createElement("iframe");(i||document.body).appendChild(f),s.then((function(){f.parentNode&&f.parentNode.removeChild(f)}));var m=f.contentWindow||f.contentDocument.parentWindow,v=function(e){var t,n,i,r=document.location,o=l.exec(e);o?(t=o[1]?o[1]:r.protocol,n=o[2],i=o[4]):(t=r.protocol,n=r.hostname,i=r.port);var a=i&&i!==d[t]?":".concat(i):"";return"".concat(t,"//").concat(n).concat(a)}(n);return{promise:new h.Promise((function(e,i){var r;void 0!==a&&(r=setTimeout((function(){var e=new Error("Connection to child timed out after ".concat(a,"ms"));e.code="ConnectionTimeout",i(e),t()}),a));var d,l,h={},y=function(t){if(t.source===m&&t.origin===v&&"handshake"===t.data.penpal){g("Parent: Received handshake, sending reply"),t.source.postMessage({penpal:"handshake-reply",methodNames:Object.keys(o)},t.origin);var n={localName:"Parent",local:u,remote:m,remoteOrigin:t.origin};l&&l();var i=new p((function(e){s.then(e),l=e}));b(n,o,i),d&&d.forEach((function(e){delete h[e]})),d=t.data.methodNames,w(h,n,d,s),clearTimeout(r),e(h)}};u.addEventListener(c,y),s.then((function(){u.removeEventListener(c,y);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",i(e)})),g("Parent: Loading iframe"),f.src=n})),iframe:f,destroy:t}},h.connectToParent=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.parentOrigin,i=void 0===n?"*":n,r=t.methods,o=void 0===r?{}:r,a=t.timeout;if(window===window.top){var s=new Error("connectToParent() must be called within an iframe");throw s.code="NotInIframe",s}var u=new p((function(t){e=t})),d=window,l=d.parent,f=new h.Promise((function(t,n){var r;void 0!==a&&(r=setTimeout((function(){var t=new Error("Connection to parent timed out after ".concat(a,"ms"));t.code="ConnectionTimeout",n(t),e()}),a));var s=function e(n){if(("*"===i||i===n.origin)&&n.source===l&&"handshake-reply"===n.data.penpal){g("Child: Received handshake reply"),d.removeEventListener(c,e);var a={localName:"Child",local:d,remote:l,remoteOrigin:n.origin},s={};b(a,o,u),w(s,a,n.data.methodNames,u),clearTimeout(r),t(s)}};d.addEventListener(c,s),u.then((function(){d.removeEventListener(c,s);var e=new Error("Connection destroyed");e.code="ConnectionDestroyed",n(e)})),g("Child: Sending handshake"),l.postMessage({penpal:"handshake",methodNames:Object.keys(o)},i)}));return{promise:f,destroy:e}};var y=h;s=a.default=y;var _=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},E=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};var C=function(){function e(t,n){this._widgetConfig=t,this._clearProviderSession=n,this._widgetUrl="https://widget.portis.io",this._onLoginCallback=function(){},this._onLogoutCallback=function(){},this._onActiveWalletChangedCallback=function(){},this._onErrorCallback=function(){},o(),t.staging&&(console.warn("Please note: you are using the Portis STAGING environment."),this._widgetUrl="https://widget-staging.portis.io"),e._checkIfWidgetAlreadyInitialized()}return e.prototype.getWidget=function(){return _(this,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:return this.widgetInstance?[3,2]:(this.widgetPromise||(this.widgetPromise=this._initWidget()),e=this,[4,this.widgetPromise]);case 1:e.widgetInstance=t.sent(),t.label=2;case 2:return[2,this.widgetInstance]}}))}))},e.prototype.setDefaultEmail=function(e){this._widgetConfig.defaultEmail=e},e.prototype.setOnLoginCallback=function(e){this._onLoginCallback=e},e.prototype.setOnLogoutCallback=function(e){this._onLogoutCallback=e},e.prototype.setOnActiveWalletChangedCallback=function(e){this._onActiveWalletChangedCallback=e},e.prototype.setOnErrorCallback=function(e){this._onErrorCallback=e},e.prototype.showPortis=function(){return _(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return[4,this.getWidget()];case 1:return[2,e.sent().communication.showPortis(this._widgetConfig)]}}))}))},e.prototype.logout=function(){return _(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return[4,this.getWidget()];case 1:return[2,e.sent().communication.logout()]}}))}))},e.prototype.getExtendedPublicKey=function(e,t){return void 0===e&&(e="m/44'/60'/0'/0/0"),void 0===t&&(t="Ethereum"),_(this,void 0,void 0,(function(){return E(this,(function(n){switch(n.label){case 0:return[4,this.getWidget()];case 1:return[2,n.sent().communication.getExtendedPublicKey(e,t,this._widgetConfig)]}}))}))},e.prototype.importWallet=function(e){return _(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,this.getWidget()];case 1:return[2,t.sent().communication.importWallet(e,this._widgetConfig)]}}))}))},e.prototype.isLoggedIn=function(){return _(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return[4,this.getWidget()];case 1:return[2,e.sent().communication.isLoggedIn()]}}))}))},e.prototype.signBitcoinTransaction=function(e){return _(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,this.getWidget()];case 1:return[2,t.sent().communication.signBitcoinTransaction(e,this._widgetConfig)]}}))}))},e.prototype.showBitcoinWallet=function(e){return void 0===e&&(e="m/49'/0'/0'/0/0"),_(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,this.getWidget()];case 1:return[2,t.sent().communication.showBitcoinWallet(e,this._widgetConfig)]}}))}))},e._checkIfWidgetAlreadyInitialized=function(){document.getElementsByClassName("por_portis-container").length&&console.warn("An instance of Portis was already initialized. This is probably a mistake. Make sure that you use the same Portis instance throughout your app.")},e.prototype._initWidget=function(){return _(this,void 0,void 0,(function(){var t,n,i,o,a;return E(this,(function(c){switch(c.label){case 0:return[4,r()];case 1:return c.sent(),(t=document.createElement("style")).innerHTML="\n.por_portis-container {\n  position: fixed;\n  width: 0px;\n  height: 0px;\n  top: 0px;\n  right: 0px;\n  z-index: 2147483647;\n}\n\n@media (max-width: 576px) {\n  .por_portis-container {\n    bottom: 0;\n    top: auto;\n  }\n}\n\n.por_portis-widget-frame {\n  position: fixed;\n  width: 375px;\n  height: 0;\n  top: 20px;\n  right: 20px;\n  box-shadow: 0 5px 40px rgba(0,0,0,.16);\n  border-radius: 8px;\n  overflow: hidden;\n  z-index: 2147483000;\n}\n\n@media (max-width: 576px) {\n  .por_portis-widget-frame {\n    bottom: 0;\n    top: auto;\n    width: 100%;\n    right: 0;\n    left: 0;\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n}\n",(n=document.createElement("div")).className="por_portis-container",(i=document.createElement("div")).id="portis-container-"+Date.now(),i.className="por_portis-widget-frame",n.appendChild(i),document.body.appendChild(n),document.head.appendChild(t),[4,(o=s.connectToChild({url:this._widgetUrl,appendTo:document.getElementById(i.id),methods:{setHeight:this._setHeight.bind(this),getWindowSize:e._getWindowSize.bind(this),onLogin:this._onLogin.bind(this),onLogout:this._onLogout.bind(this),onActiveWalletChanged:this._onActiveWalletChanged.bind(this),onError:this._onError.bind(this)}})).promise];case 2:return(a=c.sent()).setSdkConfig(this._widgetConfig),o.iframe.style.position="absolute",o.iframe.style.height="100%",o.iframe.style.width="100%",o.iframe.style.border="0 transparent",[2,{communication:a,widgetFrame:i}]}}))}))},e.prototype._setHeight=function(e){return _(this,void 0,void 0,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,this.getWidget()];case 1:return t.sent().widgetFrame.style.height=e+"px",[2]}}))}))},e._getWindowSize=function(){var e=document.getElementsByTagName("body")[0];return{width:window.innerWidth||document.documentElement.clientWidth||e.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||e.clientHeight}},e.prototype._onLogin=function(e,t,n){this._onLoginCallback&&this._onLoginCallback(e,t,n)},e.prototype._onLogout=function(){this._clearProviderSession(),this._onLogoutCallback&&this._onLogoutCallback()},e.prototype._onActiveWalletChanged=function(e){this._onActiveWalletChangedCallback&&this._onActiveWalletChangedCallback(e)},e.prototype._onError=function(e){this._onErrorCallback&&this._onErrorCallback(e)},e}(),k=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},P=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},I=require("ethereumjs-util"),x=I.addHexPrefix,W=I.stripHexPrefix,T=I.BN;function N(e,t){return k(this,void 0,void 0,(function(){var n,i,r,o,a;return P(this,(function(s){switch(s.label){case 0:return[4,e.getBlockByNumber("latest",!1)];case 1:return n=s.sent(),[4,A(e,t,n.gasLimit)];case 2:if(i=s.sent(),r=i.safeGas,o=i.simpleSend,a=i.gasLimitSpecified,o||a)return[2,r];s.label=3;case 3:return s.trys.push([3,5,,6]),[4,M(e,t,n.gasLimit,r)];case 4:return[2,s.sent()];case 5:return s.sent(),[2,r];case 6:return[2]}}))}))}function A(e,t,n){return k(this,void 0,void 0,(function(){var i,r,o;return P(this,(function(a){switch(a.label){case 0:return Boolean(t.gas)?[2,{safeGas:t.gas,simpleSend:!1,gasLimitSpecified:!0}]:(i=t.to,Boolean(i)?[4,e.getCode(i)]:[3,2]);case 1:if(r=a.sent(),!r||"0x"===r||"0x0"===r){if(t.data)throw new Error("Trying to call a function on a non-contract address");return[2,{safeGas:"0x5208",simpleSend:!0,gasLimitSpecified:!1}]}a.label=2;case 2:return o=L(n),s=o,c=20,u=new T(19),d=new T(c),[2,{safeGas:R(s.mul(u).div(d)),simpleSend:!1,gasLimitSpecified:!1}]}var s,c,u,d}))}))}function M(e,t,n,i){return k(this,void 0,void 0,(function(){var r;return P(this,(function(o){switch(o.label){case 0:return t.gas=i,r=x,[4,e.estimateGas(t)];case 1:return[2,O(r.apply(void 0,[o.sent()]),n)]}}))}))}function O(e,t){var n=L(e),i=L(t).muln(.9),r=n.muln(1.5);return n.gt(i)?R(n):r.lt(i)?R(r):R(i)}function L(e){return new T(W(e),16)}function R(e){return x(e.toString(16))}var S=function(){function e(e){this.provider=e}return e.prototype.getBlockByNumber=function(e,t){return this.sendAsync("eth_getBlockByNumber",e,t)},e.prototype.getCode=function(e,t){return void 0===t&&(t="latest"),this.sendAsync("eth_getCode",e,t)},e.prototype.estimateGas=function(e){return this.sendAsync("eth_estimateGas",e)},e.prototype.sendAsync=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return new Promise((function(i,r){t.provider.sendAsync({id:42,jsonrpc:"2.0",method:e,params:n},(function(e,t){e?r(e):i(t.result)}))}))},e}(),D=function(){return(D=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},B=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},U=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},j=require("web3-provider-engine"),F=require("web3-provider-engine/dist/es5/subproviders/cache.js"),G=require("web3-provider-engine/dist/es5/subproviders/fixture.js"),H=require("web3-provider-engine/dist/es5/subproviders/filters.js"),q=require("web3-provider-engine/dist/es5/subproviders/hooked-wallet.js"),V=require("web3-provider-engine/dist/es5/subproviders/nonce-tracker.js"),z=require("web3-provider-engine/dist/es5/subproviders/subscriptions.js"),K=function(){function t(e,t){this.config=e,this._getWidgetCommunication=t,this.provider=this._initProvider()}return t.prototype.setSelectedAddress=function(e){this._selectedAddress=e},t.prototype.changeNetwork=function(t,n){var i=e(t,n);this.clearSubprovider(V),this.clearSubprovider(F),this.config.network=i},t.prototype._initProvider=function(){var e=this;if(this.engine)return this.engine;this.engine=new j;var t=new S(this.engine);return this.engine.send=function(t,n){if("string"==typeof t)return new Promise((function(i,r){e.engine.sendAsync({jsonrpc:"2.0",id:42,method:t,params:n||[]},(function(e,t){e?r(e):i(t.result)}))}));if(!n){var i=null;switch(t.method){case"eth_accounts":case"eth_coinbase":i=e._selectedAddress?[e._selectedAddress]:[];break;case"net_version":i=e._network;break;case"eth_uninstallFilter":e.engine.sendAsync(t,(function(e){return e})),i=!0;break;default:var r="The Portis Web3 object does not support synchronous methods like "+t.method+" without a callback parameter.";throw new Error(r)}return{id:t.id,jsonrpc:t.jsonrpc,result:i}}e.engine.sendAsync(t,n)},this.engine.addProvider(new G({web3_clientVersion:"Portis/v"+this.config.version+"/javascript",net_listening:!0,eth_hashrate:"0x00",eth_mining:!1,eth_syncing:!0})),this.engine.addProvider(new F),this.engine.addProvider(new z),this.engine.addProvider(new H),this.engine.addProvider(new V),this.engine.addProvider({setEngine:function(e){return e},handleRequest:function(t,n){return B(e,void 0,void 0,(function(){return U(this,(function(e){return t.id||(t.id=42),n(),[2]}))}))}}),this.engine.addProvider(new q({getAccounts:function(t){return B(e,void 0,void 0,(function(){var e,n,i;return U(this,(function(r){switch(r.label){case 0:return[4,this._getWidgetCommunication()];case 1:return[4,r.sent().getAccounts(this.config)];case 2:return e=r.sent(),n=e.error,i=e.result,!n&&i&&(this._selectedAddress=i[0]),t(n,i),[2]}}))}))},signTransaction:function(t,n){return B(e,void 0,void 0,(function(){var e,i,r;return U(this,(function(o){switch(o.label){case 0:return[4,this._getWidgetCommunication()];case 1:return[4,o.sent().signTransaction(t,this.config)];case 2:return e=o.sent(),i=e.error,r=e.result,n(i,r),[2]}}))}))},signMessage:function(t,n){return B(e,void 0,void 0,(function(){var e,i,r,o,a;return U(this,(function(s){switch(s.label){case 0:return[4,this._getWidgetCommunication()];case 1:return e=s.sent(),i=D({},t,{messageStandard:"signMessage"}),[4,e.signMessage(i,this.config)];case 2:return r=s.sent(),o=r.error,a=r.result,n(o,a),[2]}}))}))},signPersonalMessage:function(t,n){return B(e,void 0,void 0,(function(){var e,i,r,o,a;return U(this,(function(s){switch(s.label){case 0:return[4,this._getWidgetCommunication()];case 1:return e=s.sent(),i=D({},t,{messageStandard:"signPersonalMessage"}),[4,e.signMessage(i,this.config)];case 2:return r=s.sent(),o=r.error,a=r.result,n(o,a),[2]}}))}))},signTypedMessage:function(t,n){return B(e,void 0,void 0,(function(){var e,i,r,o,a;return U(this,(function(s){switch(s.label){case 0:return[4,this._getWidgetCommunication()];case 1:return e=s.sent(),i=D({},t,{messageStandard:"signTypedMessage"}),[4,e.signMessage(i,this.config)];case 2:return r=s.sent(),o=r.error,a=r.result,n(o,a),[2]}}))}))},signTypedMessageV3:function(t,n){return B(e,void 0,void 0,(function(){var e,i,r,o,a;return U(this,(function(s){switch(s.label){case 0:return[4,this._getWidgetCommunication()];case 1:return e=s.sent(),i=D({},t,{messageStandard:"signTypedMessageV3"}),[4,e.signMessage(i,this.config)];case 2:return r=s.sent(),o=r.error,a=r.result,n(o,a),[2]}}))}))},estimateGas:function(n,i){return B(e,void 0,void 0,(function(){var e;return U(this,(function(r){switch(r.label){case 0:return[4,N(t,n)];case 1:return e=r.sent(),i(null,e),[2]}}))}))},getGasPrice:function(t){return B(e,void 0,void 0,(function(){return U(this,(function(e){return t(null,""),[2]}))}))}})),this.engine.addProvider({setEngine:function(e){return e},handleRequest:function(t,n,i){return B(e,void 0,void 0,(function(){var e,n,r;return U(this,(function(o){switch(o.label){case 0:return[4,this._getWidgetCommunication()];case 1:return[4,o.sent().relay(t,this.config)];case 2:return e=o.sent(),n=e.error,r=e.result,"net_version"===t.method&&(this._network=r,this.engine.networkVersion=this._network),i(n,r),[2]}}))}))}}),this.engine.enable=function(){return new Promise((function(t,n){e.engine.sendAsync({method:"eth_accounts"},(function(e,i){e?n(e):t(i.result)}))}))},this.engine.isConnected=function(){return!0},this.engine.isPortis=!0,this.engine.on("error",(function(e){e&&e.message&&e.message.includes("PollingBlockTracker")?console.warn("If you see this warning constantly, there might be an error with your RPC node."):console.error(e)})),this.engine.start(),this.engine},t.prototype.clearSubprovider=function(e){var t=this.provider._providers.find((function(t){return t instanceof e}));this.provider.removeProvider(t),this.provider.addProvider(new e)},t}(),Y=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},J=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Q=["email","reputation"];r().then((function(){document.getElementsByClassName("por_portis-widget-frame").length&&console.warn("Portis script was already loaded. This might cause unexpected behavior. If loading with a <script> tag, please make sure that you only load it once.")})).catch((function(){}));var X=function(){function t(t,i,r){if(void 0===r&&(r={}),!n())return new Proxy(this,{get:function(e,t){return e[t]instanceof Function?function(){}:void 0}});o(),this._validateParams(t,i,r),this._config={dappId:t,network:e(i,r.gasRelay),version:"4.0.0",scope:r.scope,registerPageByDefault:r.registerPageByDefault,staging:r.staging},this._getWidgetCommunication=this._getWidgetCommunication.bind(this),this._widgetManagerInstance=new C(this.config,this._clearProviderSession),this._web3ManagerInstance=new K(this.config,this._getWidgetCommunication),this.setDefaultEmail=this.setDefaultEmail.bind(this),this.changeNetwork=this.changeNetwork.bind(this),this.getWidget=this.getWidget.bind(this),this.onLogin=this.onLogin.bind(this),this.onLogout=this.onLogout.bind(this),this.onActiveWalletChanged=this.onActiveWalletChanged.bind(this),this.onError=this.onError.bind(this),this.showPortis=this.showPortis.bind(this),this.getExtendedPublicKey=this.getExtendedPublicKey.bind(this),this.importWallet=this.importWallet.bind(this),this.isLoggedIn=this.isLoggedIn.bind(this),this.signBitcoinTransaction=this.signBitcoinTransaction.bind(this),this.showBitcoinWallet=this.showBitcoinWallet.bind(this)}return Object.defineProperty(t.prototype,"_widgetManager",{get:function(){return this._widgetManagerInstance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_web3Manager",{get:function(){return this._web3ManagerInstance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t.prototype._clearProviderSession=function(){this._web3Manager.setSelectedAddress("")},t.prototype._getWidgetCommunication=function(){return Y(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return[4,this._widgetManager.getWidget()];case 1:return[2,e.sent().communication]}}))}))},Object.defineProperty(t.prototype,"web3Provider",{get:function(){return this._web3Manager.provider},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"provider",{get:function(){return this.web3Provider},enumerable:!0,configurable:!0}),t.prototype.changeNetwork=function(e,t){this._web3Manager.changeNetwork(e,t)},t.prototype.setDefaultEmail=function(e){this._widgetManager.setDefaultEmail(e)},t.prototype.getWidget=function(){return Y(this,void 0,void 0,(function(){return J(this,(function(e){return[2,this._widgetManager.getWidget()]}))}))},t.prototype.onLogin=function(e){this._widgetManager.setOnLoginCallback(e)},t.prototype.onLogout=function(e){this._widgetManager.setOnLogoutCallback(e)},t.prototype.onActiveWalletChanged=function(e){this._widgetManager.setOnActiveWalletChangedCallback(e)},t.prototype.onError=function(e){this._widgetManager.setOnErrorCallback(e)},t.prototype.showPortis=function(){return Y(this,void 0,void 0,(function(){return J(this,(function(e){return[2,this._widgetManager.showPortis()]}))}))},t.prototype.logout=function(){return Y(this,void 0,void 0,(function(){return J(this,(function(e){return[2,this._widgetManager.logout()]}))}))},t.prototype.getExtendedPublicKey=function(e,t){return void 0===e&&(e="m/44'/60'/0'/0/0"),void 0===t&&(t="Ethereum"),Y(this,void 0,void 0,(function(){return J(this,(function(n){return[2,this._widgetManager.getExtendedPublicKey(e,t)]}))}))},t.prototype.importWallet=function(e){return Y(this,void 0,void 0,(function(){return J(this,(function(t){return[2,this._widgetManager.importWallet(e)]}))}))},t.prototype.isLoggedIn=function(){return Y(this,void 0,void 0,(function(){return J(this,(function(e){return[2,this._widgetManager.isLoggedIn()]}))}))},t.prototype.signBitcoinTransaction=function(e){return Y(this,void 0,void 0,(function(){return J(this,(function(t){return[2,this._widgetManager.signBitcoinTransaction(e)]}))}))},t.prototype.showBitcoinWallet=function(e){return void 0===e&&(e="m/49'/0'/0'/0/0"),Y(this,void 0,void 0,(function(){return J(this,(function(t){return[2,this._widgetManager.showBitcoinWallet(e)]}))}))},t.prototype._validateParams=function(e,t,n){if(!e)throw new Error("[Portis] 'dappId' is required. Get your dappId here: https://dashboard.portis.io");if(!t)throw new Error("[Portis] 'network' is required. Read more about it here: https://docs.portis.io/#/configuration?id=network");if(n.scope){if(!Array.isArray(n.scope))throw new Error("[Portis] 'scope' must be an array. Read more about it here: https://docs.portis.io/#/configuration?id=scope");if(n.scope.filter((function(e){return Q.indexOf(e)<0})).length>0)throw new Error("[Portis] invalid 'scope' parameter. Read more about it here: https://docs.portis.io/#/configuration?id=scope")}if(void 0!==n.registerPageByDefault&&"boolean"!=typeof n.registerPageByDefault)throw new Error("[Portis] invalid 'registerPageByDefault' parameter, must be a boolean. Read more about it here: https://docs.portis.io/#/configuration?id=registerPageByDefault")},t}();export default X;
